---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const movies = await getCollection("apiMovies");
---

<BaseLayout title="MovieStore-lab">
  <main class="container">
    <h1>hello from Categories</h1>
    <section>
      {
        movies.map((m) => (
          <article class="border-2 p-4">
            <a href="./info">
              <h1>
                {m.data.title} - ({m.data.release_date.slice(0, 4)})
              </h1>
              <h5>
                Rating: ({m.data.vote_average}/10) - Votes: {m.data.vote_count}{" "}
              </h5>
              <div class="grid">
                <img src={`https://image.tmdb.org/t/p/w200${m.data.poster_path}`} />

                <ul>
                  <li>
                    <strong>Overview:</strong> {m.data.overview}
                  </li>
                  <li>Release date: {m.data.release_date}</li>
                  <li>Language: {m.data.original_language.toUpperCase()}</li>
                  <li>Popularity: {m.data.popularity}</li>
                  <li>
                    Categories:
                    {m.data.genre_ids.map((c) => (
                      <b>{c},</b>
                    ))}
                  </li>
                </ul>
              </div>
            </a>
            <footer>
              <button class="add-to-cart" data-movieid={m.data.id}>
                Add to cart
              </button>
            </footer>
          </article>
        ))
      }
    </section>
    <blockquote>
      Contact is a funny word. Some people think design means how it looks. But of course, if you dig deeper, it's
      really how it works.”
      <footer>
        <cite>— Steve Jobs</cite>
      </footer>
    </blockquote>
  </main>
  <script is:inline>
    // Wait for the DOM to load
    document.addEventListener("DOMContentLoaded", () => {
      const buttons = document.querySelectorAll(".add-to-cart");

      buttons.forEach((btn) => {
        btn.addEventListener("click", () => {
          const movieId = parseInt(btn.getAttribute("data-movieid"));

          // Parse the cart from localStorage (or start a new one)
          const cart = JSON.parse(localStorage.getItem("cart")) || [];

          // Check if item is already in cart
          const existingItem = cart.find((item) => item.id === movieId);
          if (existingItem) {
            existingItem.quantity += 1;
          } else {
            cart.push({ id: movieId, quantity: 1 });
          }

          // Save back to localStorage
          localStorage.setItem("cart", JSON.stringify(cart));
          alert("Movie added to cart!");
        });
      });
    });
  </script>
</BaseLayout>
<style>
  article {
    border-color: rgba(0, 0, 0, 0.432);
  }
  a:hover {
    color: var(--pico-primary-focus);
  }
  ul {
    margin-left: 1.5rem;
  }
  article p,
  article ul {
    color: var(--pico-h3-color);
  }
</style>
